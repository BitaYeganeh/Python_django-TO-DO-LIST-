
<!doctype html>
<html lang="en">
  <head>
    {% load static %}

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <title>My To-Do App</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'tasks/style.css' %}"
    />

    <!-- SweetAlert2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>

  <body>
    <!-- Auth Bar -->
    <div class="auth-bar">
      {% if user.is_authenticated %}
      <span>Hi {{ user.username }}, Welcome!</span>
      <a href="{% url 'logout' %}">Logout</a>
      {% else %}
      <a href="{% url 'login' %}">Login</a>
      <a href="{% url 'signup' %}">Sign up</a>
      {% endif %}
    </div>

    <!-- Messages (optional, still shows flash) -->
    {% if messages %}
      <div class="messages">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}

    <!-- Main Container -->
    <div class="container">
      <h1>My To-Do List</h1>

      <!-- Demo Button -->
      <div class="demo-link">
        <a href="{% url 'demo_tasks' %}">Try Demo</a>

        {% if user.is_authenticated %}
          <a href="{% url 'task_list' %}">My own Tasks</a>
        {% endif %}
      </div>

      <!-- Add Task Form -->
      {% if user.is_authenticated and not demo %}
      <form method="post">
        {% csrf_token %}
        <div class="form-group">
          <label for="id_title">Task:</label>
          <input type="text" name="title" id="id_title" placeholder="Enter task title" required />
        </div>
        <div class="form-group">
          <label for="id_completed">Completed:</label>
          <input type="checkbox" name="completed" id="id_completed" />
        </div>
        <button type="submit">Add Task</button>
      </form>
      {% elif demo %}
      <p style="text-align:center; font-style:italic;">
        Demo mode — sign up to create your own tasks ✨
      </p>
      {% else %}
      <p style="text-align:center; font-style:italic;">
        Login to create your own tasks!
      </p>
      {% endif %}

      <!-- Task List -->
      <ul>
        {% for task in tasks %}
        <li class="task-item">
          {% if task.completed %}
            <s>{{ task.title }}</s>
          {% else %}
            {{ task.title }}
          {% endif %}

          <div>
            {% if demo or not user.is_authenticated %}
              <a href="#" onclick="Swal.fire({
                  icon: 'warning',
                  title: 'Action blocked!',
                  text: 'You need to sign up to edit tasks!',
                  confirmButtonText: 'Ok'
              }); return false;">Complete</a>

              <a href="#" onclick="Swal.fire({
                  icon: 'warning',
                  title: 'Action blocked!',
                  text: 'You need to sign up to delete tasks!',
                  confirmButtonText: 'Ok'
              }); return false;" class="delete">Delete</a>
            {% else %}
              <a href="{% url 'complete_task' task.id %}">Complete</a>
              <a href="{% url 'delete_task' task.id %}" class="delete">Delete</a>
            {% endif %}
          </div>
        </li>
        {% empty %}
        {% if demo %}
        <li style="text-align:center; font-style: italic;">No demo tasks yet!</li>

        {% else %}
        <li style="text-align:center; font-style: italic;">You have no tasks added yet!</li>
        {% endif %}
        {% endfor %}
      </ul>
    </div>
  </body>
</html>
